{% style %}
  /* Estilos usando variables globales */
  body {
    padding-top: var(--header-height);
  }
  
  .header {
    background-color: var(--color-background);
    color: var(--color-foreground);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    border-bottom: 1px solid var(--color-border);
    box-shadow: var(--shadow-sm);
    transition: all var(--transition-medium);
    backdrop-filter: blur(0px);
    -webkit-backdrop-filter: blur(0px);
    transform: translateY(0);
    opacity: 1;
    visibility: visible;
    height: var(--header-height);
  }
  
  .header.scrolled {
    box-shadow: var(--shadow-md);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    background-color: rgba(var(--color-background), 0.95);
    height: var(--header-height-scrolled);
  }
  
  .header.hidden {
    transform: translateY(-100%);
    opacity: 0;
    visibility: hidden;
  }
  
  .container {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 0 var(--page-margin);
  }
  
  .header-container {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    align-items: center;
    padding: 1.5rem 20px;
    transition: padding var(--transition-medium);
    height: 100%;
  }
  
  .header.scrolled .header-container {
    padding: 0.8rem 10px;
  }
  
  .header-logo {
    justify-self: start;
  }
  
  .header-logo img {
    max-width: 180px;
    height: auto;
    transition: transform var(--transition-fast);
  }
  
  .header-logo img:hover {
    transform: scale(1.03);
  }
  
  .nav-desktop ul {
    display: flex;
    justify-content: center;
    gap: 2.5rem;
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .nav-link {
    color: var(--color-foreground);
    font-family: var(--font-heading);
    font-weight: 400;
    font-size: 1.1rem;
    position: relative;
    padding-bottom: 0.5rem;
    text-decoration: none;
    transition: color var(--transition-fast);
  }
  
  .nav-link:hover {
    color: var(--color-primary);
  }
  
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background-color: var(--color-primary);
    transform: scaleX(0);
    transition: transform var(--transition-medium);
  }
  
  .nav-link:hover::after {
    transform: scaleX(1);
  }
  
  .header-actions {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 1.5rem;
  }
  
  .header-icon {
    width: 24px;
    height: 24px;
    transition: all var(--transition-fast);
    color: var(--color-foreground);
  }
  
  .header-icon:hover {
    color: var(--color-primary);
    transform: scale(1.1);
  }
  
  /* Buscador */
  .search-container {
    position: relative;
    display: flex;
    align-items: center;
  }
  
  .search-form {
    position: absolute;
    top: 50%;
    right: 100%;
    transform: translateY(-50%);
    width: 0;
    overflow: hidden;
    transition: width var(--transition-medium);
    background: var(--color-background);
    z-index: 100;
    box-shadow: var(--shadow-sm);
    border-radius: 30px;
    height: 40px;
    display: flex;
    align-items: center;
    margin-right: 10px;
  }
  
  .search-active .search-form {
    width: 250px;
    border: 1px solid var(--color-border);
  }
  
  .search-form input {
    width: 100%;
    padding: 0 1rem;
    border: none;
    background: transparent;
    color: var(--color-foreground);
    height: 100%;
    outline: none;
    font-family: var(--font-body);
    font-size: 0.95rem;
  }
  
  .search-toggle {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform var(--transition-fast);
  }
  
  .search-toggle:focus {
    outline: none;
  }
  
  .mobile-menu-button {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
  }
  
  .cart-count {
    background-color: var(--color-primary);
    color: var(--color-primary-foreground);
    text-align: center;
    font-size: 0.7rem;
    border-radius: 50%;
    height: 18px;
    width: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: -5px;
    right: -8px;
    font-weight: 600;
  }
  
  /* Menú móvil */
  .mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.7);
    z-index: 1000;
    display: none;
    opacity: 0;
    transition: opacity var(--transition-medium);
  }
  
  .mobile-menu.active {
    display: block;
    opacity: 1;
  }
  
  .mobile-menu-panel {
    position: fixed;
    top: 0;
    left: 0;
    width: 85%;
    max-width: 320px;
    height: 100%;
    background-color: white;
    transform: translateX(-100%);
    transition: transform var(--transition-slow);
    z-index: 1001;
    overflow-y: auto;
    padding: 20px;
  }
  
  .mobile-menu.active .mobile-menu-panel {
    transform: translateX(0);
  }
  
  .mobile-menu-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--color-border);
    margin-bottom: 20px;
  }
  
  .mobile-logo img {
    max-width: 140px;
  }
  
  .mobile-menu-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--color-foreground);
  }
  
  .mobile-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .mobile-nav li {
    margin-bottom: 12px;
  }
  
  .mobile-nav a {
    display: block;
    padding: 12px 0;
    color: var(--color-foreground);
    font-family: var(--font-heading);
    font-weight: 600;
    text-decoration: none;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    transition: color var(--transition-fast);
  }
  
  .mobile-nav a:hover {
    color: var(--color-primary);
  }
  
  .mobile-actions {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--color-border);
  }
  
  .mobile-account-link,
  .mobile-cart-link {
    display: flex;
    align-items: center;
    padding: 10px 0;
    color: var(--color-foreground);
    text-decoration: none;
  }
  
  .mobile-account-link:hover,
  .mobile-cart-link:hover {
    color: var(--color-primary);
  }
  
  .mobile-icon {
    width: 20px;
    height: 20px;
    margin-right: 10px;
  }
  
  /* Responsive */
  @media (max-width: 1023px) {
    body {
      padding-top: var(--header-height-scrolled);
    }
    
    .header-container {
      grid-template-columns: 1fr 1fr;
      padding: 1rem 10px;
    }
    
    .nav-desktop {
      display: none;
    }
    
    .header-actions {
      grid-column: 2;
      grid-row: 1;
    }
    
    .mobile-menu-button {
      display: block;
    }
    
    .header-logo {
      grid-row: 1;
      grid-column: 1;
    }
    
    .header-logo img {
      max-width: 140px;
    }
    
    .search-active .search-form {
      position: fixed;
      top: var(--header-height-scrolled);
      left: 0;
      width: 100vw !important;
      margin-left: 0;
      border-radius: 0;
      border: none;
      border-top: 1px solid var(--color-border);
      box-shadow: var(--shadow-sm);
      height: 50px;
      z-index: 1000;
    }
    
    .header.scrolled .header-container {
      padding: 0.5rem 10px;
    }
  }
{% endstyle %}

<header class="header" id="main-header">
  <div class="container header-container">
    <div class="header-logo">
      <a href="/" title="{{ shop.name }}">
        {% if section.settings.logo %}
          <img
            src="{{ section.settings.logo | image_url }}"
            alt="{{ shop.name }}"
            width="{{ section.settings.logo_width }}"
            height="auto"
            loading="eager"
          >
        {% else %}
          <span class="text-xl font-bold">{{ shop.name }}</span>
        {% endif %}
      </a>
    </div>

    <nav class="nav-desktop">
      <ul>
        <li><a href="/" class="nav-link">Inicio</a></li>
        <li><a href="/collections/Alquiler" class="nav-link">Alquiler</a></li>
        <li><a href="/collections/Venta" class="nav-link">Venta</a></li>
        <li><a href="#instalaciones" class="nav-link">Quiénes somos</a></li>
        <li><a href="#contacto" class="nav-link">Contacto</a></li>
      </ul>
    </nav>

    <div class="header-actions">
      <div class="search-container">
        <button class="search-toggle" aria-label="Buscar">
          <svg class="header-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </button>
        
        <div class="search-form">
          <form action="/search" method="get" role="search">
            <input
              type="search"
              name="q"
              placeholder="Buscar productos..."
              aria-label="Buscar"
            >
          </form>
        </div>
      </div>

      <a href="/account" class="text-current hover:text-primary" aria-label="Cuenta">
        <svg class="header-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
      </a>

      <a href="/cart" class="text-current hover:text-primary relative" aria-label="Carrito">
        <svg class="header-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        <span class="cart-count absolute -top-2 -right-2 bg-primary text-primary-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center">
          {{ cart.item_count }}
        </span>
      </a>

      <button class="mobile-menu-button text-current hover:text-primary" aria-label="Menú móvil" id="mobileMenuButton">
        <svg class="header-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>
</header>

<div class="mobile-menu" id="mobileMenu">
  <div class="mobile-menu-panel">
    <div class="mobile-menu-header">
      <div class="mobile-logo">
        <a href="/" title="{{ shop.name }}">
          {% if section.settings.logo %}
            <img
              src="{{ section.settings.logo | image_url }}"
              alt="{{ shop.name }}"
              width="140"
              height="auto"
              loading="eager"
            >
          {% else %}
            <span class="text-xl font-bold">{{ shop.name }}</span>
          {% endif %}
        </a>
      </div>
      <button class="mobile-menu-close" id="mobileMenuClose">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <nav class="mobile-nav">
      <ul>
        <li><a href="/" class="mobile-menu-link">Inicio</a></li>
        <li><a href="#productos" class="mobile-menu-link">Productos</a></li>
        <li><a href="#servicio-tecnico" class="mobile-menu-link">Servicio Técnico</a></li>
        <li><a href="#instalaciones" class="mobile-menu-link">Instalaciones</a></li>
        <li><a href="#contacto" class="mobile-menu-link">Contacto</a></li>
      </ul>
    </nav>
    
    <div class="mobile-actions">
      <a href="/account" class="mobile-account-link">
        <svg class="mobile-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        Mi Cuenta
      </a>
      
      <a href="/cart" class="mobile-cart-link">
        <svg class="mobile-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        Carrito ({{ cart.item_count }})
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchToggle = document.querySelector('.search-toggle');
    const searchContainer = document.querySelector('.search-container');
    const mobileMenuButton = document.getElementById('mobileMenuButton');
    const mobileMenuClose = document.getElementById('mobileMenuClose');
    const mobileMenu = document.getElementById('mobileMenu');
    const header = document.getElementById('main-header');
    let lastScrollY = window.scrollY;
    
    // Buscador expandible
    if (searchToggle) {
      searchToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        searchContainer.classList.toggle('search-active');
        
        if (searchContainer.classList.contains('search-active')) {
          setTimeout(() => {
            const searchInput = searchContainer.querySelector('input[type="search"]');
            if (searchInput) searchInput.focus();
          }, 300);
        }
      });
      
      document.addEventListener('click', function(event) {
        if (!searchContainer.contains(event.target)) {
          searchContainer.classList.remove('search-active');
        }
      });
    }
    
    // Menú móvil
    if (mobileMenuButton) {
      mobileMenuButton.addEventListener('click', function() {
        mobileMenu.classList.add('active');
        document.body.style.overflow = 'hidden';
      });
    }
    
    if (mobileMenuClose) {
      mobileMenuClose.addEventListener('click', function() {
        mobileMenu.classList.remove('active');
        document.body.style.overflow = '';
      });
    }
    
    mobileMenu.addEventListener('click', function(e) {
      if (e.target === mobileMenu) {
        mobileMenu.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
    
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && mobileMenu.classList.contains('active')) {
        mobileMenu.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
    
    // Scroll suave
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function(e) {
        e.preventDefault();
        
        if (mobileMenu.classList.contains('active')) {
          mobileMenu.classList.remove('active');
          document.body.style.overflow = '';
        }
        
        const targetId = this.getAttribute('href');
        const targetElement = document.querySelector(targetId);
        
        if (targetElement) {
          window.scrollTo({
            top: targetElement.offsetTop - 80,
            behavior: 'smooth'
          });
          
          if (history.pushState) {
            history.pushState(null, null, targetId);
          } else {
            location.hash = targetId;
          }
        }
      });
    });
    
    // Comportamiento del header al hacer scroll
    window.addEventListener('scroll', function() {
      const currentScrollY = window.scrollY;
      
      if (currentScrollY > 10) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
      
      if (currentScrollY > lastScrollY && currentScrollY > 100) {
        header.classList.add('hidden');
      } else {
        header.classList.remove('hidden');
      }
      
      lastScrollY = currentScrollY;
    });
  });
</script>

{% schema %}
{
  "name": "Encabezado",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo",
      "info": "Recomendado: 180px de ancho"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "unit": "px",
      "label": "Ancho del logo",
      "default": 180
    }
  ]
}
{% endschema %}