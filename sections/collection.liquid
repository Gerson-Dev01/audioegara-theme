{% comment %}
  collection.liquid - Plantilla para mostrar productos con filtros y paginación manejada por JavaScript.
{% endcomment %}

{% assign filter = request.params.filter %}

<div class="collection-container">
  <h1>{{ collection.title }}</h1>

  <div class="filters">
    <label for="product-type">Filtrar por tipo:</label>
    <select id="product-type" name="filter" onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);">
      <option value="{{ collection.url }}" {% if filter == blank %}selected{% endif %}>Todos</option>
      {% assign product_types = '' | split: '' %}
      {% for product in collection.products %}
        {% assign product_type = product.type | handleize %}
        {% unless product_types contains product_type or product_type == blank %}
          {% assign product_types = product_types | push: product_type %}
          <option value="{{ collection.url }}?filter={{ product_type }}" {% if filter == product_type %}selected{% endif %}>
            {{ product.type | default: "Sin tipo" }}
          </option>
        {% endunless %}
      {% endfor %}
    </select>
  </div>

  {% assign filtered_products = '' | split: '' %}
  {% for product in collection.products %}
    {% assign product_type = product.type | handleize %}
    {% if filter == blank or filter == product_type %}
      {% assign filtered_products = filtered_products | push: product %}
    {% endif %}
  {% endfor %}

  {% if filtered_products.size > 0 %}
    <div class="product-grid" id="product-grid">
      {% for product in filtered_products %}
        <div class="product-item">
          <a href="{{ product.url }}">
            <h3>{{ product.title }}</h3>
            {% if product.featured_image %}
              <img src="{{ product.featured_image | img_url: '300x300' }}" alt="{{ product.title }}">
            {% else %}
              <p>No hay imagen disponible</p>
            {% endif %}
            <p>{{ product.price | money }}</p>
          </a>
        </div>
      {% endfor %}
    </div>
    <div class="pagination" id="pagination">
      <!-- La paginación se manejará con JavaScript -->
    </div>
  {% else %}
    <p>No hay productos disponibles para este filtro.</p>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const products = document.querySelectorAll('.product-item');
    const productsPerPage = 12;
    const totalProducts = products.length;
    const totalPages = Math.ceil(totalProducts / productsPerPage);
    const paginationContainer = document.getElementById('pagination');
    const productGrid = document.getElementById('product-grid');

    // Crear botones de paginación
    for (let i = 1; i <= totalPages; i++) {
      const button = document.createElement('button');
      button.textContent = i;
      button.dataset.page = i;
      button.addEventListener('click', function() {
        const page = parseInt(this.dataset.page);
        showPage(page);
      });
      paginationContainer.appendChild(button);
    }

    // Mostrar la primera página al cargar
    showPage(1);

    function showPage(page) {
      const startIndex = (page - 1) * productsPerPage;
      const endIndex = startIndex + productsPerPage;

      // Ocultar todos los productos
      products.forEach(product => {
        product.style.display = 'none';
      });

      // Mostrar solo los productos de la página actual
      for (let i = startIndex; i < endIndex && i < totalProducts; i++) {
        products[i].style.display = 'block';
      }

      // Resaltar el botón de la página actual
      const buttons = paginationContainer.querySelectorAll('button');
      buttons.forEach(button => {
        button.style.fontWeight = button.dataset.page == page ? 'bold' : 'normal';
      });
    }
  });
</script>

<style>
  .collection-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .filters {
    margin-bottom: 20px;
  }

  .filters select {
    padding: 8px;
    margin-left: 10px;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
  }

  .product-item {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
    display: none; /* Inicialmente ocultos, se mostrarán con JavaScript */
  }

  .product-item img {
    max-width: 100%;
    height: auto;
  }

  .pagination {
    margin-top: 20px;
    text-align: center;
  }

  .pagination button {
    margin: 0 5px;
    padding: 5px 10px;
    cursor: pointer;
  }
</style>
