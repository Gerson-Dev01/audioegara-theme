{% comment %}
  collection.liquid - Plantilla para mostrar productos con filtros por tipo de producto.
{% endcomment %}

{% assign filter = request.params.filter %}

<div class="collection-container">
  <h1>{{ collection.title }}</h1>

  <!-- Filtro por tipo de producto -->
  <div class="filters">
    <label for="product-type">Filtrar por tipo:</label>
    <select id="product-type" name="filter" onchange="window.location = this.value;">
      <option value="{{ collection.url }}" {% unless filter %}selected{% endunless %}>Todos</option>
      {% assign product_types = '' | split: '' %}
      {% for product in collection.products %}
        {% assign product_type = product.type | handleize %}
        {% unless product_types contains product_type or product_type == blank %}
          {% assign product_types = product_types | push: product_type %}
          <option value="{{ collection.url }}?filter={{ product_type }}" {% if filter == product_type %}selected{% endif %}>
            {{ product.type | default: "Sin tipo" }}
          </option>
        {% endunless %}
      {% endfor %}
    </select>
  </div>

  <!-- Depuración: Verificar el valor del filtro -->
  <p>Valor del filtro: {{ filter }}</p>

  {% if collection.products.size > 0 %}
    <div class="product-grid">
      {% for product in collection.products %}
        {% assign product_type = product.type | handleize %}
        {% if filter == blank or filter == nil %}
          <!-- Mostrar todos los productos si no hay filtro seleccionado -->
          <div class="product-item">
            <a href="{{ product.url }}">
              <h3>{{ product.title }}</h3>
              {% if product.featured_image %}
                <img src="{{ product.featured_image | img_url: '300x300' }}" alt="{{ product.title }}">
              {% else %}
                <p>No hay imagen disponible</p>
              {% endif %}
              <p>{{ product.price | money }}</p>
            </a>
          </div>
        {% elsif filter == product_type %}
          <!-- Mostrar solo los productos que coinciden con el filtro seleccionado -->
          <div class="product-item">
            <a href="{{ product.url }}">
              <h3>{{ product.title }}</h3>
              {% if product.featured_image %}
                <img src="{{ product.featured_image | img_url: '300x300' }}" alt="{{ product.title }}">
              {% else %}
                <p>No hay imagen disponible</p>
              {% endif %}
              <p>{{ product.price | money }}</p>
            </a>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% else %}
    <p>No hay productos en esta colección.</p>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const filterSelect = document.getElementById('product-type');
    const urlParams = new URLSearchParams(window.location.search);
    const filterParam = urlParams.get('filter');

    if (filterParam) {
      const optionValue = "{{ collection.url }}?filter=" + filterParam;
      filterSelect.value = optionValue;
    }
  });
</script>

<style>
  .collection-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .filters {
    margin-bottom: 20px;
  }

  .filters select {
    padding: 8px;
    margin-left: 10px;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
  }

  .product-item {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }

  .product-item img {
    max-width: 100%;
    height: auto;
  }
</style>
