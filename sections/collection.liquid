{% comment %}
  collection.liquid - Plantilla básica para mostrar productos con paginación y filtro por tipo de producto.
{% endcomment %}

{% assign filter = request.params.filter %}

<div class="collection-container">
  <h1>{{ collection.title }}</h1>

  <div class="filters">
    <label for="product-type">Filtrar por tipo:</label>
    <select id="product-type" name="filter" onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);">
      <option value="{{ collection.url }}" {% if filter == blank %}selected{% endif %}>Todos</option>
      {% assign product_types = '' | split: '' %}
      {% for product in collection.products %}
        {% assign product_type = product.type | handleize %}
        {% unless product_types contains product_type %}
          {% assign product_types = product_types | push: product_type %}
          <option value="{{ collection.url }}?filter={{ product_type }}" {% if filter == product_type %}selected{% endif %}>
            {{ product.type }}
          </option>
        {% endunless %}
      {% endfor %}
    </select>
  </div>

  {% if filter == blank %}
    {% paginate collection.products by 12 %}
      <div class="product-grid">
        {% for product in paginate.items %}
          <div class="product-item">
            <a href="{{ product.url }}">
              <h3>{{ product.title }}</h3>
              {% if product.featured_image %}
                <img src="{{ product.featured_image | img_url: '300x300' }}" alt="{{ product.title }}">
              {% endif %}
              <p>{{ product.price | money }}</p>
            </a>
          </div>
        {% endfor %}
      </div>
      {{ paginate | default_pagination }}
    {% endpaginate %}
  {% else %}
    {% assign filtered_products = '' | split: '' %}
    {% for product in collection.products %}
      {% assign product_type = product.type | handleize %}
      {% if filter == product_type %}
        {% assign filtered_products = filtered_products | push: product %}
      {% endif %}
    {% endfor %}

    {% if filtered_products.size > 0 %}
      <div class="product-grid">
        {% for product in filtered_products %}
          <div class="product-item">
            <a href="{{ product.url }}">
              <h3>{{ product.title }}</h3>
              {% if product.featured_image %}
                <img src="{{ product.featured_image | img_url: '300x300' }}" alt="{{ product.title }}">
              {% endif %}
              <p>{{ product.price | money }}</p>
            </a>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No hay productos disponibles para este filtro.</p>
    {% endif %}
  {% endif %}
</div>

<style>
  .collection-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .filters {
    margin-bottom: 20px;
  }

  .filters select {
    padding: 8px;
    margin-left: 10px;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
  }

  .product-item {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }

  .product-item img {
    max-width: 100%;
    height: auto;
  }

  .pagination {
    margin-top: 20px;
    text-align: center;
  }
</style>
